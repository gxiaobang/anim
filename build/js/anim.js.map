{"version":3,"sources":["anim.js"],"names":[],"mappings":"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","file":"anim.js","sourcesContent":["/**\r\n * tw.js\r\n * 微型动画库\r\n * by bang\r\n */\r\n\r\nimport { getDOM, getStyle, setStyle, requestAnim } from './util.js';\r\nimport { Tween } from './tween.js';\r\n\r\n// 补间动画\r\nclass Anim {\r\n\tconstructor(el, options) {\r\n\t\tthis.el = getDOM(el)[0];\r\n\t\tthis.fn = {};\r\n\t\tthis.queue = [];\r\n\t\tthis.addQueue(options);\r\n\t}\r\n\r\n\t// 清除\r\n\tstop() {\r\n\t\tthis.animated = false;\r\n\t\tthis.shiftQueue();\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 添加队列\r\n\taddQueue({ from, to, duration, tween }) {\r\n\t\tthis.queue.push({\r\n\t\t\tfrom: from || {},\r\n\t\t\tto: to || {},\r\n\t\t\tduration: Anim.toMs(duration) || '400',\r\n\t\t\teaseFn: Anim.getTween(tween)\r\n\t\t});\r\n\t}\r\n\t// 清除队列\r\n\tclearQueue() {\r\n\t\tthis.queue = [];\r\n\t}\r\n\r\n\tshiftQueue() {\r\n\t\tthis.queue.unshift();\r\n\t}\r\n\r\n\t// 运行\r\n\trun() {\r\n\t\tthis.begin();\r\n\t\tvar { duration } = this.queue[0];\r\n\t\tconst loop = () => {\r\n\t\t\t// 停止\r\n\t\t\tif (!this.animated) return;\r\n\r\n\t\t\tthis.elespedTime = +new Date - this.startTime;\r\n\t\t\tif (this.elespedTime > duration) {\r\n\t\t\t\tthis.complete();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.moving();\r\n\t\t\t\trequestAnim(loop);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\trequestAnim(loop);\r\n\t\treturn this;\r\n\t}\r\n\t// 开始\r\n\tbegin() {\r\n\t\tthis.animated = true;\r\n\t\tthis.startTime = +new Date;\r\n\r\n\t\tvar { from, to } = this.queue[0];\r\n\r\n\t\tfor (let name in to) {\r\n\t\t\tif (!from.hasOwnProperty(name)) {\r\n\t\t\t\tfrom[ name ] = parseFloat(getStyle(this.el, name));\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.fn.begin && this.fn.begin();\r\n\t\treturn this;\r\n\t}\r\n\t// 执行动画中，按fps触发\r\n\tmoving() {\r\n\t\tvar t, b, c, d;\r\n\t\tvar { from, to, duration, easeFn } = this.queue[0];\r\n\t\tfor (let name in to) {\r\n\t\t\tt = this.elespedTime;\r\n\t\t\tb = parseFloat(from[name]);\r\n\t\t\tc = parseFloat(to[name]) - b;\r\n\t\t\td = duration;\r\n\r\n\t\t\tsetStyle(this.el, name, easeFn(t, b, c, d));\r\n\t\t}\r\n\t\tthis.fn.moving && this.fn.moving();\r\n\t\treturn this;\r\n\t}\r\n\t// 完成动画\r\n\tcomplete() {\r\n\t\tvar { to } = this.queue[0];\r\n\t\tthis.animated = false;\r\n\t\tsetStyle(this.el, to);\r\n\t\tthis.shiftQueue();\r\n\t\tthis.fn.complete && this.fn.complete();\r\n\t\treturn this;\r\n\t}\r\n\r\n\tset(prop, value) {\r\n\t\tswitch (prop) {\r\n\t\t\tcase 'tween':\r\n\t\t\t\tthis.queue[0].easeFn = Anim.getTween(value);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis.queue[0][ prop ] = value;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t// 转化成毫秒\r\n\tstatic toMs(ms) {\r\n\t\treturn /\\ds$/.test(ms) ? parseFloat(ms) * 1000 : parseFloat(ms);\r\n\t}\r\n\r\n\t// 获取缓动公式\r\n\tstatic getTween(type) {\r\n\t\tif (typeof type == 'string') {\r\n\t\t\tlet arr = type.split('.');\r\n\t\t\tif (arr[0] == 'Linear') {\r\n\t\t\t\treturn Tween[arr[0]];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn Tween[arr[0]][arr[1]];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const anim = (el, options) => new Anim(el, options);"],"sourceRoot":"/source/"}